1) spark.sql("SELECT count(customerid) count FROM CustView WHERE age < 30 AND salary > 100000").show()
2) spark.sql("SELECT customerid, age, CASE WHEN age < 1 THEN 'invalid' WHEN age >= 1 and age < 20 THEN '<20' WHEN age >= 20 and age < 30 THEN '20-29' WHEN age >= 30 and age < 40 THEN '30-39' WHEN age >= 40 and age < 50 THEN '40-49' ELSE '>=50' END AS age_group FROM CustView").show()
3) spark.sql("SELECT housing,COUNT(customerid) FROM CustView WHERE balance < 0 GROUP BY housing").show()
4) spark.sql("SELECT SUBSTR(jobedu, 1, INSTR(jobedu, ',')-1) AS job, SUBSTR(jobedu, INSTR(jobedu, ',')+1) AS education FROM CustView").show()
5) spark.sql("SELECT SUBSTR(jobedu, 1, INSTR(jobedu, ',')-1) AS job, COUNT(customerid) AS custcount FROM CUSTVIEW c WHERE housing = 'yes' GROUP BY job HAVING custcount = (SELECT MAX(c_count) FROM (SELECT count(customerid) AS c_count FROM CUSTVIEW WHERE housing = 'yes' GROUP BY SUBSTR(jobedu, 1, INSTR(jobedu, ',')-1)))").show()
6) spark.sql("SELECT month, count(customerid) FROM CustView GROUP BY month").show()
7) spark.sql("SELECT response, AVG(dur) avg_duration FROM (SELECT response, CASE WHEN SUBSTR(duration, INSTR(duration, ' ') + 1) = 'min' THEN ROUND(SUBSTR(duration, 1, INSTR(duration, ' ') - 1) * 60, 2) ELSE SUBSTR(duration, 1, INSTR(duration, ' ')) * 1 END AS dur FROM CustView) GROUP BY response").show()
8) spark.sql("SELECT count(customerid) FROM CustView WHERE housing = 'yes' AND loan = 'yes'").show()
9) spark.sql("SELECT COUNT(customerid) COUNT, CASE WHEN salary < 40000 AND salary >= 1 THEN '<40K' WHEN salary < 1 THEN 'INVALID' WHEN salary >= 40000 AND salary < 80000 THEN '40K-80K' WHEN salary >= 80000 AND salary < 120000 THEN '80K-120K' ELSE '>=120K' END AS salary_group FROM CustView GROUP BY salary_group").show()
10) spark.sql("SELECT COUNT(customerid) custcount FROM CustView WHERE housing = 'yes' AND marital = 'single'").show()
11) spark.sql("SELECT customerid, age, salary, housing, CASE WHEN age > 18 and age < 45 and salary > 30000 and housing = 'no' THEN 1 ELSE 0 END AS car_loan FROM CustView").show()
